import {drizzle}from'drizzle-orm/postgres-js';import nt from'postgres';import {pgEnum,pgTable,timestamp,boolean,text,uuid,integer,jsonb,date,numeric,time,index,uniqueIndex,check,inet}from'drizzle-orm/pg-core';import {relations,sql}from'drizzle-orm';import at from'dotenv';var Ae=Object.defineProperty;var Re=(e,g)=>{for(var c in g)Ae(e,c,{get:g[c],enumerable:true});};var ce={};Re(ce,{adjustmentTypeEnum:()=>J,auditLogs:()=>tt,availability:()=>Pe,availabilityStatusEnum:()=>M,bookingStatusEnum:()=>L,bookings:()=>p,cancellationPolicies:()=>Ue,cancellationTypeEnum:()=>W,cancelledByEnum:()=>F,customerProfiles:()=>ne,idTypeEnum:()=>T,mediaTypeEnum:()=>V,messages:()=>Je,notificationChannelEnum:()=>Q,notifications:()=>We,ownerProfiles:()=>ie,paymentMethodEnum:()=>G,paymentStatusEnum:()=>H,paymentTxnStatusEnum:()=>Y,payments:()=>Ve,payoutStatusEnum:()=>ze,priceRuleTypeEnum:()=>$,priceRules:()=>je,reviews:()=>$e,sessions:()=>De,stayIntentEnum:()=>j,stayMedia:()=>R,stayMediaRelations:()=>Me,stayStatusEnum:()=>B,stayTypeEnum:()=>U,stayUnits:()=>u,stayUnitsRelations:()=>Oe,stays:()=>o,staysRelations:()=>Be,supportMessages:()=>Qe,supportTickets:()=>ke,ticketCategoryEnum:()=>X,ticketPriorityEnum:()=>Z,ticketStatusEnum:()=>ee,unitTypeEnum:()=>O,userRoleEnum:()=>C,users:()=>t,verificationStatusEnum:()=>P});var C=pgEnum("user_role",["customer","owner","admin"]),P=pgEnum("verification_status",["pending","verified","rejected"]),T=pgEnum("id_type",["citizenship","national_id_card","passport","national_id"]),U=pgEnum("stay_type",["hotel","homestay","apartment","room","hostel"]),j=pgEnum("stay_intent",["short_stay","long_stay","both"]),B=pgEnum("stay_status",["draft","pending_review","active","suspended","archived"]),O=pgEnum("unit_type",["private_room","shared_room","entire_place","bed"]),M=pgEnum("availability_status",["available","blocked","booked"]),V=pgEnum("media_type",["image","video"]),L=pgEnum("booking_status",["initiated","reserved","confirmed","checked_in","completed","cancelled","expired","no_show","pending"]),H=pgEnum("payment_status",["not_required","pending","success","failed","refunded","unpaid","paid"]),F=pgEnum("cancelled_by",["customer","owner","admin","system"]),G=pgEnum("payment_method",["khalti","esewa","bank_transfer","cash","wallet"]),Y=pgEnum("payment_txn_status",["initiated","pending","completed","failed","refunded"]),$=pgEnum("price_rule_type",["seasonal","weekend","holiday","long_stay","last_minute"]),J=pgEnum("adjustment_type",["fixed","percent"]),W=pgEnum("cancellation_type",["flexible","moderate","strict","non_refundable"]),ze=pgEnum("payout_status",["pending","processing","completed","failed"]),Q=pgEnum("notification_channel",["in_app","email","sms","push"]),X=pgEnum("ticket_category",["booking","payment","property","account","other"]),Z=pgEnum("ticket_priority",["low","medium","high","urgent"]),ee=pgEnum("ticket_status",["open","in_progress","waiting_customer","resolved","closed"]);var t=pgTable("users",{id:uuid("id").defaultRandom().primaryKey(),email:text("email").notNull().unique(),phone:text("phone").unique(),fullName:text("full_name").notNull(),avatarUrl:text("avatar_url"),role:C("role").default("customer").notNull(),password:text("password"),emailVerified:boolean("email_verified").default(false),phoneVerified:boolean("phone_verified").default(false),isActive:boolean("is_active").default(true),lastLoginAt:timestamp("last_login_at",{withTimezone:true}),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow(),updatedAt:timestamp("updated_at",{withTimezone:true}).defaultNow()}),ie=pgTable("owner_profiles",{id:uuid("id").defaultRandom().primaryKey(),userId:uuid("user_id").references(()=>t.id).notNull().unique(),nationality:text("nationality").default("Nepali"),businessName:text("business_name"),panNumber:text("pan_number"),idType:T("id_type"),idNumber:text("id_number"),idFrontUrl:text("id_front_url"),idBackUrl:text("id_back_url"),bankName:text("bank_name"),bankAccount:text("bank_account"),address:text("address"),verificationStatus:P("verification_status").default("pending"),totalEarnings:integer("total_earnings").default(0),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()}),ne=pgTable("customer_profiles",{id:uuid("id").defaultRandom().primaryKey(),userId:uuid("user_id").references(()=>t.id).notNull().unique(),dateOfBirth:date("date_of_birth"),nationality:text("nationality").default("Nepali"),idType:T("id_type"),idNumber:text("id_number"),idFrontUrl:text("id_front_url"),idBackUrl:text("id_back_url"),emergencyContact:text("emergency_contact"),preferences:jsonb("preferences").default({}),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()}),De=pgTable("sessions",{id:uuid("id").defaultRandom().primaryKey(),userId:uuid("user_id").references(()=>t.id).notNull(),token:text("token").notNull(),expiresAt:timestamp("expires_at",{withTimezone:true}).notNull(),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()});var o=pgTable("stays",{id:uuid("id").defaultRandom().primaryKey(),ownerId:uuid("owner_id").references(()=>t.id).notNull(),name:text("name").notNull(),slug:text("slug").notNull().unique(),description:text("description"),type:U("type").notNull(),intent:j("intent").default("both"),status:B("status").default("draft"),addressLine:text("address_line").notNull(),city:text("city").notNull(),district:text("district").notNull(),province:text("province"),latitude:numeric("latitude",{precision:10,scale:7}),longitude:numeric("longitude",{precision:10,scale:7}),basePrice:integer("base_price").notNull(),maxGuests:integer("max_guests").default(2),amenities:jsonb("amenities").default([]),rules:jsonb("rules").default([]),checkInTime:time("check_in_time").default("14:00:00"),checkOutTime:time("check_out_time").default("11:00:00"),avgRating:numeric("avg_rating",{precision:2,scale:1}).default("0"),totalReviews:integer("total_reviews").default(0),totalBookings:integer("total_bookings").default(0),isFeatured:boolean("is_featured").default(false),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow(),updatedAt:timestamp("updated_at",{withTimezone:true}).defaultNow()},e=>({ownerIdIdx:index("stay_owner_id_idx").on(e.ownerId)})),u=pgTable("stay_units",{id:uuid("id").defaultRandom().primaryKey(),stayId:uuid("stay_id").references(()=>o.id).notNull(),name:text("name").notNull(),type:O("type").notNull(),maxOccupancy:integer("max_occupancy").default(2).notNull(),basePrice:integer("base_price").notNull(),quantity:integer("quantity").default(1),amenities:jsonb("amenities").default([]),isActive:boolean("is_active").default(true),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()},e=>({stayIdIdx:index("stay_unit_stay_id_idx").on(e.stayId)})),Pe=pgTable("availability",{id:uuid("id").defaultRandom().primaryKey(),unitId:uuid("unit_id").references(()=>u.id).notNull(),date:date("date",{mode:"string"}).notNull(),availableCount:integer("available_count").notNull(),priceOverride:integer("price_override"),minNights:integer("min_nights").default(1),status:M("status").default("available")},e=>({unq:uniqueIndex("availability_unit_date_idx").on(e.unitId,e.date)})),R=pgTable("stay_media",{id:uuid("id").defaultRandom().primaryKey(),stayId:uuid("stay_id").references(()=>o.id).notNull(),unitId:uuid("unit_id").references(()=>u.id),url:text("url").notNull(),thumbnailUrl:text("thumbnail_url"),type:V("type").default("image"),caption:text("caption"),sortOrder:integer("sort_order").default(0),isCover:boolean("is_cover").default(false),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()}),Ue=pgTable("cancellation_policies",{id:uuid("id").defaultRandom().primaryKey(),stayId:uuid("stay_id").references(()=>o.id).unique(),type:W("type").default("moderate"),freeCancelHours:integer("free_cancel_hours").default(48),refundPercentBefore:integer("refund_percent_before").default(100),refundPercentAfter:integer("refund_percent_after").default(0),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()}),je=pgTable("price_rules",{id:uuid("id").defaultRandom().primaryKey(),stayId:uuid("stay_id").references(()=>o.id).notNull(),unitId:uuid("unit_id").references(()=>u.id),name:text("name").notNull(),type:$("type").notNull(),adjustmentType:J("adjustment_type").notNull(),adjustmentValue:integer("adjustment_value").notNull(),startDate:date("start_date",{mode:"string"}),endDate:date("end_date",{mode:"string"}),daysOfWeek:jsonb("days_of_week"),minNights:integer("min_nights"),isActive:boolean("is_active").default(true),priority:integer("priority").default(0),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()}),Be=relations(o,({many:e})=>({stayUnits:e(u),stayMedia:e(R)})),Oe=relations(u,({one:e})=>({stay:e(o,{fields:[u.stayId],references:[o.id]})})),Me=relations(R,({one:e})=>({stay:e(o,{fields:[R.stayId],references:[o.id]})}));var p=pgTable("bookings",{id:uuid("id").defaultRandom().primaryKey(),bookingNumber:text("booking_number").notNull().unique(),stayId:uuid("stay_id").references(()=>o.id).notNull(),unitId:uuid("unit_id").references(()=>u.id).notNull(),customerId:uuid("customer_id").references(()=>t.id).notNull(),ownerId:uuid("owner_id").references(()=>t.id).notNull(),checkIn:date("check_in",{mode:"string"}).notNull(),checkOut:date("check_out",{mode:"string"}).notNull(),nights:integer("nights").notNull(),guestsCount:integer("guests_count").default(1).notNull(),guestName:text("guest_name").notNull(),guestEmail:text("guest_email"),guestPhone:text("guest_phone"),baseAmount:integer("base_amount").notNull(),taxes:integer("taxes").default(0),serviceFee:integer("service_fee").default(0),discount:integer("discount").default(0),totalAmount:integer("total_amount").notNull(),currency:text("currency").default("NPR"),status:L("status").default("initiated").notNull(),paymentStatus:H("payment_status").default("not_required").notNull(),expiresAt:timestamp("expires_at",{withTimezone:true}),metadata:jsonb("metadata"),specialRequests:text("special_requests"),cancellationReason:text("cancellation_reason"),cancelledBy:F("cancelled_by"),cancelledAt:timestamp("cancelled_at",{withTimezone:true}),confirmedAt:timestamp("confirmed_at",{withTimezone:true}),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow(),updatedAt:timestamp("updated_at",{withTimezone:true}).defaultNow()},e=>({stayIdIdx:index("booking_stay_id_idx").on(e.stayId),customerIdIdx:index("booking_customer_id_idx").on(e.customerId),ownerIdIdx:index("booking_owner_id_idx").on(e.ownerId)})),Ve=pgTable("payments",{id:uuid("id").defaultRandom().primaryKey(),bookingId:uuid("booking_id").references(()=>p.id).notNull(),userId:uuid("user_id").references(()=>t.id).notNull(),amount:integer("amount").notNull(),currency:text("currency").default("NPR"),method:G("method").notNull(),gatewayTxnId:text("gateway_txn_id"),gatewayResponse:jsonb("gateway_response"),status:Y("status").default("initiated").notNull(),refundAmount:integer("refund_amount").default(0),refundReason:text("refund_reason"),paidAt:timestamp("paid_at",{withTimezone:true}),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()});var $e=pgTable("reviews",{id:uuid("id").defaultRandom().primaryKey(),bookingId:uuid("booking_id").references(()=>p.id).unique().notNull(),stayId:uuid("stay_id").references(()=>o.id).notNull(),userId:uuid("user_id").references(()=>t.id).notNull(),rating:integer("rating").notNull(),comment:text("comment"),updatedAt:timestamp("updated_at").defaultNow(),createdAt:timestamp("created_at").defaultNow()},e=>({ratingCheck:check("rating_check",sql`${e.rating} >= 1 AND ${e.rating} <= 5`),stayIdIdx:index("review_stay_id_idx").on(e.stayId),userIdIdx:index("review_user_id_idx").on(e.userId)}));var Je=pgTable("messages",{id:uuid("id").defaultRandom().primaryKey(),conversationId:uuid("conversation_id").notNull(),senderId:uuid("sender_id").references(()=>t.id).notNull(),receiverId:uuid("receiver_id").references(()=>t.id).notNull(),bookingId:uuid("booking_id").references(()=>p.id),content:text("content").notNull(),isRead:boolean("is_read").default(false),readAt:timestamp("read_at",{withTimezone:true}),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()},e=>({conversationIdIdx:index("message_conversation_id_idx").on(e.conversationId),senderIdIdx:index("message_sender_id_idx").on(e.senderId),receiverIdIdx:index("message_receiver_id_idx").on(e.receiverId),bookingIdIdx:index("message_booking_id_idx").on(e.bookingId)})),We=pgTable("notifications",{id:uuid("id").defaultRandom().primaryKey(),userId:uuid("user_id").references(()=>t.id).notNull(),type:text("type").notNull(),title:text("title").notNull(),body:text("body"),data:jsonb("data").default({}),channel:Q("channel").default("in_app"),isRead:boolean("is_read").default(false),readAt:timestamp("read_at",{withTimezone:true}),sentAt:timestamp("sent_at",{withTimezone:true}).defaultNow()},e=>({userIdIdx:index("notification_user_id_idx").on(e.userId)})),ke=pgTable("support_tickets",{id:uuid("id").defaultRandom().primaryKey(),ticketNumber:text("ticket_number").notNull().unique(),userId:uuid("user_id").references(()=>t.id).notNull(),bookingId:uuid("booking_id").references(()=>p.id),category:X("category").notNull(),subject:text("subject").notNull(),priority:Z("priority").default("medium"),status:ee("status").default("open"),assignedTo:uuid("assigned_to").references(()=>t.id),resolvedAt:timestamp("resolved_at",{withTimezone:true}),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()},e=>({userIdIdx:index("support_ticket_user_id_idx").on(e.userId),bookingIdIdx:index("support_ticket_booking_id_idx").on(e.bookingId),assignedToIdx:index("support_ticket_assigned_to_idx").on(e.assignedTo)})),Qe=pgTable("support_messages",{id:uuid("id").defaultRandom().primaryKey(),ticketId:uuid("ticket_id").references(()=>ke.id).notNull(),senderId:uuid("sender_id").references(()=>t.id).notNull(),content:text("content").notNull(),attachments:jsonb("attachments").default([]),isInternal:boolean("is_internal").default(false),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()},e=>({ticketIdIdx:index("support_message_ticket_id_idx").on(e.ticketId)}));var tt=pgTable("audit_logs",{id:uuid("id").defaultRandom().primaryKey(),userId:uuid("user_id").references(()=>t.id),action:text("action").notNull(),entityType:text("entity_type").notNull(),entityId:uuid("entity_id").notNull(),oldValues:jsonb("old_values"),newValues:jsonb("new_values"),ipAddress:inet("ip_address"),userAgent:text("user_agent"),createdAt:timestamp("created_at",{withTimezone:true}).defaultNow()});at.config();var Te=process.env.DATABASE_URL;if(!Te)throw new Error("DATABASE_URL is not set");var K=nt(Te,{prepare:false,ssl:"require"}),f=drizzle(K,{schema:ce});var ot=async()=>{console.log("\u{1F331} Seeding database...");try{let[e]=await f.insert(t).values({email:"admin@staysewa.com",fullName:"Super Admin",role:"admin",emailVerified:!0}).returning();console.log("Created Admin:",e.id);let[g]=await f.insert(t).values({email:"owner@example.com",fullName:"John Owner",phone:"9841000000",role:"owner",emailVerified:!0}).returning();await f.insert(ie).values({userId:g.id,businessName:"Himalayan Hospitality",verificationStatus:"verified"}),console.log("Created Owner:",g.id);let[c]=await f.insert(t).values({email:"guest@example.com",fullName:"Alice Guest",phone:"9800000000",role:"customer",emailVerified:!0}).returning();await f.insert(ne).values({userId:c.id,nationality:"Nepali"}),console.log("Created Customer:",c.id);let[D]=await f.insert(o).values({ownerId:g.id,name:"Cozy Himalayan Hostel",slug:"cozy-himalayan-hostel",type:"hostel",intent:"short_stay",addressLine:"Thamel Marg",city:"Kathmandu",district:"Kathmandu",province:"Bagmati",basePrice:1500,description:"A beautiful hostel in the heart of Thamel.",status:"active",amenities:["wifi","hot_shower"]}).returning();console.log("Created Stay:",D.id);let[me]=await f.insert(u).values({stayId:D.id,name:"Mixed Dorm Bed",type:"bed",maxOccupancy:1,basePrice:1500,quantity:10}).returning();console.log("Created Unit:",me.id);let pe=new Date,v=new Date(pe);v.setDate(pe.getDate()+1);let _e=new Date(v);_e.setDate(v.getDate()+4);let fe=Ee=>Ee.toISOString().split("T")[0];await f.insert(p).values({bookingNumber:"STY-SEED-001",stayId:D.id,unitId:me.id,customerId:c.id,ownerId:g.id,guestName:c.fullName,guestEmail:c.email,guestPhone:c.phone,checkIn:fe(v),checkOut:fe(_e),nights:4,baseAmount:6e3,totalAmount:6e3,status:"confirmed",paymentStatus:"paid"}),console.log("Created Booking: STY-SEED-001"),console.log("\u2705 Seeding complete!"),await K.end(),process.exit(0);}catch(e){console.error("\u274C Seeding failed:",e),await K.end(),process.exit(1);}};ot();