{"version":3,"sources":["../src/app.ts","../src/utils/AppError.ts","../src/config/env.ts","../src/middlewares/errorHandler.ts","../src/db/schema/index.ts","../src/db/schema/enums.ts","../src/db/schema/users.ts","../src/db/schema/stays.ts","../src/db/schema/bookings.ts","../src/db/schema/social.ts","../src/db/schema/audit.ts","../src/db/index.ts","../src/services/stay.service.ts","../src/utils/catchAsync.ts","../src/controllers/stays.controller.ts","../src/middlewares/validate.middleware.ts","../src/validations/stay.schema.ts","../src/routes/stays.routes.ts","../src/services/booking.service.ts","../src/controllers/bookings.controller.ts","../src/validations/booking.schema.ts","../src/routes/bookings.routes.ts","../src/services/owner.service.ts","../src/controllers/owners.controller.ts","../src/routes/owners.routes.ts","../src/services/customer.service.ts","../src/controllers/customers.controller.ts","../src/routes/customers.routes.ts","../src/controllers/user.controller.ts","../src/routes/user.routes.ts","../src/services/media.service.ts","../src/controllers/media.controller.ts","../src/routes/media.routes.ts","../src/services/auth.service.ts","../src/controllers/auth.controller.ts","../src/middlewares/auth.middleware.ts","../src/validations/auth.schema.ts","../src/routes/auth.routes.ts","../src/routes/index.ts","../src/index.ts"],"names":["AppError","message","statusCode","dotenv","getEnv","key","required","value","env","globalErrorHandler","err","req","res","next","schema_exports","__export","adjustmentTypeEnum","auditLogs","availability","availabilityStatusEnum","bookingStatusEnum","bookings","cancellationPolicies","cancellationTypeEnum","cancelledByEnum","customerProfiles","mediaTypeEnum","messages","notificationChannelEnum","notifications","ownerProfiles","paymentMethodEnum","paymentStatusEnum","paymentTxnStatusEnum","payments","payoutStatusEnum","priceRuleTypeEnum","priceRules","reviews","sessions","stayIntentEnum","stayMedia","stayStatusEnum","stayTypeEnum","stayUnits","stays","supportMessages","supportTickets","ticketCategoryEnum","ticketPriorityEnum","ticketStatusEnum","unitTypeEnum","userRoleEnum","users","verificationStatusEnum","pgEnum","pgTable","uuid","text","boolean","timestamp","integer","date","jsonb","numeric","time","inet","connectionString","client","postgres","db","drizzle","StaysService","id","eq","catchAsync","fn","StaysController","stay","validate","schema","error","ZodError","staySchema","z","router","Router","stays_routes_default","BookingsService","desc","data","status","BookingsController","booking","newBooking","updatedBooking","bookingSchema","bookings_routes_default","OwnersService","and","userData","email","OwnersController","owners","owner","newOwner","owners_routes_default","CustomersService","CustomersController","customers","customer","newCustomer","customers_routes_default","UserController","mockUser","user_routes_default","MediaService","stayId","propertyOnly","query","isNull","unitId","tx","contextQuery","MediaController","url","type","caption","isCover","media","media_routes_default","AuthService","secret","jwt","entered","stored","bcrypt","pass","user","password","userWithoutPassword","hashedPassword","AuthController","token","cookieOptions","fullName","role","newUser","protect","decoded","currentUser","authSchema","auth_routes_default","routes_default","app","express","helmet","cors","cookieParser","_req","_res","app_default","bootstrap","port"],"mappings":"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","file":"index.js","sourcesContent":["import express from 'express';\nimport cors from 'cors';\nimport helmet from 'helmet';\nimport cookieParser from 'cookie-parser';\nimport { globalErrorHandler } from '@/middlewares/errorHandler';\nimport { AppError } from '@/utils/AppError';\nimport routes from '@/routes';\n\nconst app = express();\n\n// Global Middlewares\napp.use(helmet());\napp.use(cors({ origin: 'http://localhost:3000', credentials: true }));\napp.use(express.json());\napp.use(cookieParser());\n\n// Routes\napp.get('/health', (_req, res) => {\n    res.status(200).json({ status: 'success', message: 'StaySewa API is healthy' });\n});\n\napp.use('/api', routes);\n\n// 404 Handler\napp.use((req, _res, next) => {\n    next(new AppError(`Can't find ${req.originalUrl} on this server!`, 404));\n});\n\n// Global Error Handler\napp.use(globalErrorHandler);\n\nexport default app;\n","export class AppError extends Error {\n    public readonly statusCode: number;\n    public readonly status: string;\n    public readonly isOperational: boolean;\n\n    constructor(message: string, statusCode: number) {\n        super(message);\n        this.statusCode = statusCode;\n        this.status = `${statusCode}`.startsWith('4') ? 'fail' : 'error';\n        this.isOperational = true;\n\n        Error.captureStackTrace(this, this.constructor);\n    }\n}\n","import dotenv from 'dotenv';\ndotenv.config();\n\nconst getEnv = (key: string, required: boolean = true): string => {\n    const value = process.env[key];\n    if (required && !value) {\n        throw new Error(`Missing required environment variable: ${key}`);\n    }\n    return value || '';\n};\n\nexport const env = {\n    NODE_ENV: getEnv('NODE_ENV', false) || 'development',\n    PORT: parseInt(getEnv('PORT', false) || '4000', 10),\n    DATABASE_URL: getEnv('DATABASE_URL', true),\n    // Add other env vars here as needed\n};\n","import type { Request, Response, NextFunction } from 'express';\nimport { AppError } from '@/utils/AppError';\nimport { env } from '@/config/env';\n\nexport const globalErrorHandler = (err: any, req: Request, res: Response, next: NextFunction) => {\n    err.statusCode = err.statusCode || 500;\n    err.status = err.status || 'error';\n\n    if (env.NODE_ENV === 'development') {\n        res.status(err.statusCode).json({\n            status: err.status,\n            error: err,\n            message: err.message,\n            stack: err.stack,\n        });\n    } else {\n        // Production: Don't leak stack traces\n        if (err.isOperational) {\n            res.status(err.statusCode).json({\n                status: err.status,\n                message: err.message,\n            });\n        } else {\n            // Programming or other unknown error: don't leak details\n            console.error('ERROR ðŸ’¥', err);\n            res.status(500).json({\n                status: 'error',\n                message: 'Something went very wrong!',\n            });\n        }\n    }\n};\n","export * from '@/db/schema/enums';\nexport * from '@/db/schema/users';\nexport * from '@/db/schema/stays';\nexport * from '@/db/schema/bookings';\nexport * from '@/db/schema/social';\nexport * from '@/db/schema/audit';\n","import { pgEnum } from 'drizzle-orm/pg-core';\n\n// â”€â”€â”€ User & Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const userRoleEnum = pgEnum('user_role', ['customer', 'owner', 'admin']);\nexport const verificationStatusEnum = pgEnum('verification_status', ['pending', 'verified', 'rejected']);\n\n// â”€â”€â”€ Stay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const stayTypeEnum = pgEnum('stay_type', ['hotel', 'homestay', 'apartment', 'room', 'hostel']);\nexport const stayIntentEnum = pgEnum('stay_intent', ['short_stay', 'long_stay', 'both']);\nexport const stayStatusEnum = pgEnum('stay_status', ['draft', 'pending_review', 'active', 'suspended', 'archived']);\nexport const unitTypeEnum = pgEnum('unit_type', ['private_room', 'shared_room', 'entire_place', 'bed']);\nexport const availabilityStatusEnum = pgEnum('availability_status', ['available', 'blocked', 'booked']);\nexport const mediaTypeEnum = pgEnum('media_type', ['image', 'video']);\n\n// â”€â”€â”€ Booking â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const bookingStatusEnum = pgEnum('booking_status', [\n    'pending', 'confirmed', 'checked_in', 'completed', 'cancelled', 'no_show',\n]);\nexport const paymentStatusEnum = pgEnum('payment_status', ['unpaid', 'partial', 'paid', 'refunded']);\nexport const cancelledByEnum = pgEnum('cancelled_by', ['customer', 'owner', 'admin', 'system']);\n\n// â”€â”€â”€ Payment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const paymentMethodEnum = pgEnum('payment_method', [\n    'khalti', 'esewa', 'bank_transfer', 'cash', 'wallet',\n]);\nexport const paymentTxnStatusEnum = pgEnum('payment_txn_status', [\n    'initiated', 'pending', 'completed', 'failed', 'refunded',\n]);\n\n// â”€â”€â”€ Pricing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const priceRuleTypeEnum = pgEnum('price_rule_type', [\n    'seasonal', 'weekend', 'holiday', 'long_stay', 'last_minute',\n]);\nexport const adjustmentTypeEnum = pgEnum('adjustment_type', ['fixed', 'percent']);\n\n// â”€â”€â”€ Cancellation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const cancellationTypeEnum = pgEnum('cancellation_type', [\n    'flexible', 'moderate', 'strict', 'non_refundable',\n]);\n\n// â”€â”€â”€ Payout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const payoutStatusEnum = pgEnum('payout_status', ['pending', 'processing', 'completed', 'failed']);\n\n// â”€â”€â”€ Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const notificationChannelEnum = pgEnum('notification_channel', [\n    'in_app', 'email', 'sms', 'push',\n]);\n\n// â”€â”€â”€ Support â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const ticketCategoryEnum = pgEnum('ticket_category', [\n    'booking', 'payment', 'property', 'account', 'other',\n]);\nexport const ticketPriorityEnum = pgEnum('ticket_priority', ['low', 'medium', 'high', 'urgent']);\nexport const ticketStatusEnum = pgEnum('ticket_status', [\n    'open', 'in_progress', 'waiting_customer', 'resolved', 'closed',\n]);\n","import { pgTable, text, uuid, timestamp, boolean, integer, date, jsonb } from 'drizzle-orm/pg-core';\nimport { userRoleEnum, verificationStatusEnum } from '@/db/schema/enums';\n\n// â”€â”€â”€ Users (Unified Auth) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const users = pgTable('users', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    email: text('email').notNull().unique(),\n    phone: text('phone').unique(),\n    fullName: text('full_name').notNull(),\n    avatarUrl: text('avatar_url'),\n    role: userRoleEnum('role').default('customer').notNull(),\n    password: text('password'), // Add password field\n    emailVerified: boolean('email_verified').default(false),\n    phoneVerified: boolean('phone_verified').default(false),\n    isActive: boolean('is_active').default(true),\n    lastLoginAt: timestamp('last_login_at', { withTimezone: true }),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n    updatedAt: timestamp('updated_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Owner Profiles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const ownerProfiles = pgTable('owner_profiles', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    userId: uuid('user_id').references(() => users.id).notNull().unique(),\n    businessName: text('business_name'),\n    panNumber: text('pan_number'),\n    citizenshipNumber: text('citizenship_number'),\n    bankName: text('bank_name'),\n    bankAccount: text('bank_account'),\n    address: text('address'),\n    verificationStatus: verificationStatusEnum('verification_status').default('pending'),\n    totalEarnings: integer('total_earnings').default(0), // stored in paisa\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Customer Profiles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const customerProfiles = pgTable('customer_profiles', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    userId: uuid('user_id').references(() => users.id).notNull().unique(),\n    dateOfBirth: date('date_of_birth'),\n    nationality: text('nationality').default('Nepali'),\n    idType: text('id_type'),\n    idNumber: text('id_number'),\n    emergencyContact: text('emergency_contact'),\n    preferences: jsonb('preferences').default({}),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ User Sessions (Optional, if not using Supabase Auth only) â”€\nexport const sessions = pgTable('sessions', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    userId: uuid('user_id').references(() => users.id).notNull(),\n    token: text('token').notNull(),\n    expiresAt: timestamp('expires_at', { withTimezone: true }).notNull(),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n","import { pgTable, text, uuid, timestamp, boolean, integer, numeric, jsonb, time, date } from 'drizzle-orm/pg-core';\nimport { users } from '@/db/schema/users';\nimport { stayTypeEnum, stayIntentEnum, stayStatusEnum, unitTypeEnum, availabilityStatusEnum, mediaTypeEnum, cancellationTypeEnum, priceRuleTypeEnum, adjustmentTypeEnum } from '@/db/schema/enums';\n\n// â”€â”€â”€ Stays (Property Listing) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const stays = pgTable('stays', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    ownerId: uuid('owner_id').references(() => users.id).notNull(),\n    name: text('name').notNull(),\n    slug: text('slug').notNull().unique(), // URL-friendly slug\n    description: text('description'),\n    type: stayTypeEnum('type').notNull(),\n    intent: stayIntentEnum('intent').default('both'),\n    status: stayStatusEnum('status').default('draft'),\n\n    // Location\n    addressLine: text('address_line').notNull(),\n    city: text('city').notNull(),\n    district: text('district').notNull(),\n    province: text('province'),\n    latitude: numeric('latitude', { precision: 10, scale: 7 }),\n    longitude: numeric('longitude', { precision: 10, scale: 7 }),\n\n    // Pricing & Rules\n    basePrice: integer('base_price').notNull(), // in Paisa\n    maxGuests: integer('max_guests').default(2),\n    amenities: jsonb('amenities').default([]), // [\"wifi\", \"parking\"]\n    rules: jsonb('rules').default([]), // [\"no_smoking\"]\n    checkInTime: time('check_in_time').default('14:00:00'),\n    checkOutTime: time('check_out_time').default('11:00:00'),\n\n    // Stats (Denormalized/Cached)\n    avgRating: numeric('avg_rating', { precision: 2, scale: 1 }).default('0'),\n    totalReviews: integer('total_reviews').default(0),\n    totalBookings: integer('total_bookings').default(0),\n    isFeatured: boolean('is_featured').default(false),\n\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n    updatedAt: timestamp('updated_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Stay Units (Rooms/Beds) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const stayUnits = pgTable('stay_units', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    stayId: uuid('stay_id').references(() => stays.id).notNull(),\n    name: text('name').notNull(), // \"Deluxe Room\"\n    type: unitTypeEnum('type').notNull(),\n    maxOccupancy: integer('max_occupancy').default(2).notNull(),\n    basePrice: integer('base_price').notNull(), // Unit-specific price\n    quantity: integer('quantity').default(1),\n    amenities: jsonb('amenities').default([]),\n    isActive: boolean('is_active').default(true),\n\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Availability Calendar (Per Unit Per Day) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const availability = pgTable('availability', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    unitId: uuid('unit_id').references(() => stayUnits.id).notNull(),\n    date: date('date', { mode: 'string' }).notNull(),\n    availableCount: integer('available_count').notNull(),\n    priceOverride: integer('price_override'), // Seasonal daily price\n    minNights: integer('min_nights').default(1),\n    status: availabilityStatusEnum('status').default('available'),\n});\n// Note: Composite unique index on (unit_id, date) should be added in migration\n\n// â”€â”€â”€ Stay Media (Photos/Videos) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const stayMedia = pgTable('stay_media', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    stayId: uuid('stay_id').references(() => stays.id).notNull(),\n    unitId: uuid('unit_id').references(() => stayUnits.id), // Optional: link photo to specific unit\n    url: text('url').notNull(),\n    thumbnailUrl: text('thumbnail_url'),\n    type: mediaTypeEnum('type').default('image'),\n    caption: text('caption'),\n    sortOrder: integer('sort_order').default(0),\n    isCover: boolean('is_cover').default(false),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Cancellation Policies â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const cancellationPolicies = pgTable('cancellation_policies', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    stayId: uuid('stay_id').references(() => stays.id).unique(),\n    type: cancellationTypeEnum('type').default('moderate'),\n    freeCancelHours: integer('free_cancel_hours').default(48),\n    refundPercentBefore: integer('refund_percent_before').default(100),\n    refundPercentAfter: integer('refund_percent_after').default(0),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Price Rules (Seasonal / Weekend) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const priceRules = pgTable('price_rules', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    stayId: uuid('stay_id').references(() => stays.id).notNull(),\n    unitId: uuid('unit_id').references(() => stayUnits.id), // Optional: apply to specific unit\n    name: text('name').notNull(),\n    type: priceRuleTypeEnum('type').notNull(),\n    adjustmentType: adjustmentTypeEnum('adjustment_type').notNull(),\n    adjustmentValue: integer('adjustment_value').notNull(),\n    startDate: date('start_date', { mode: 'string' }),\n    endDate: date('end_date', { mode: 'string' }),\n    daysOfWeek: jsonb('days_of_week'), // [0, 6] for Sun/Sat\n    minNights: integer('min_nights'),\n    isActive: boolean('is_active').default(true),\n    priority: integer('priority').default(0),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Reviews â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n// Circular reference: Reviews need Bookings, but Bookings need Stays.\n// Solving by importing `bookings` from bookings.ts later, but for now we reference schema by name\n// or define reviews in bookings.ts? Better to keep reviews here near Stays or in separate file.\n// Let's keep reviews here but use booking_id as reference without strict TS import cycle if possible.\n// Actually, circular imports in Drizzle are tricky. Let's verify.\n// In Drizzle, table references function lazily `() => table`.\n// So we can import bookings.ts even if bookings.ts imports stays.ts.\n","import { pgTable, text, uuid, timestamp, boolean, integer, numeric, jsonb, date } from 'drizzle-orm/pg-core';\nimport { users } from '@/db/schema/users';\nimport { stays, stayUnits } from '@/db/schema/stays';\nimport { bookingStatusEnum, paymentStatusEnum, paymentMethodEnum, paymentTxnStatusEnum, cancelledByEnum } from '@/db/schema/enums';\n\n// â”€â”€â”€ Bookings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const bookings = pgTable('bookings', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    bookingNumber: text('booking_number').notNull().unique(), // STY-20231001-A1B2\n    stayId: uuid('stay_id').references(() => stays.id).notNull(),\n    unitId: uuid('unit_id').references(() => stayUnits.id).notNull(),\n    customerId: uuid('customer_id').references(() => users.id).notNull(),\n    ownerId: uuid('owner_id').references(() => users.id).notNull(), // Denormalized for query speed\n\n    checkIn: date('check_in', { mode: 'string' }).notNull(),\n    checkOut: date('check_out', { mode: 'string' }).notNull(),\n    nights: integer('nights').notNull(),\n    guestsCount: integer('guests_count').default(1).notNull(),\n\n    // Guest Snapshot\n    guestName: text('guest_name').notNull(),\n    guestEmail: text('guest_email'),\n    guestPhone: text('guest_phone'),\n\n    // Financials (in Paisa)\n    baseAmount: integer('base_amount').notNull(),\n    taxes: integer('taxes').default(0),\n    serviceFee: integer('service_fee').default(0),\n    discount: integer('discount').default(0),\n    totalAmount: integer('total_amount').notNull(),\n    currency: text('currency').default('NPR'),\n\n    // Status\n    status: bookingStatusEnum('status').default('pending').notNull(),\n    paymentStatus: paymentStatusEnum('payment_status').default('unpaid').notNull(),\n\n    specialRequests: text('special_requests'),\n    cancellationReason: text('cancellation_reason'),\n    cancelledBy: cancelledByEnum('cancelled_by'),\n    cancelledAt: timestamp('cancelled_at', { withTimezone: true }),\n    confirmedAt: timestamp('confirmed_at', { withTimezone: true }),\n\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n    updatedAt: timestamp('updated_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Payments â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const payments = pgTable('payments', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    bookingId: uuid('booking_id').references(() => bookings.id).notNull(),\n    userId: uuid('user_id').references(() => users.id).notNull(), // Who paid\n    amount: integer('amount').notNull(),\n    currency: text('currency').default('NPR'),\n    method: paymentMethodEnum('method').notNull(),\n    gatewayTxnId: text('gateway_txn_id'), // Khalti/eSewa ID\n    gatewayResponse: jsonb('gateway_response'),\n    status: paymentTxnStatusEnum('status').default('initiated').notNull(),\n    refundAmount: integer('refund_amount').default(0),\n    refundReason: text('refund_reason'),\n    paidAt: timestamp('paid_at', { withTimezone: true }),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Reviews â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const reviews = pgTable('reviews', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    bookingId: uuid('booking_id').references(() => bookings.id).unique().notNull(),\n    stayId: uuid('stay_id').references(() => stays.id).notNull(),\n    reviewerId: uuid('reviewer_id').references(() => users.id).notNull(),\n    rating: integer('rating').notNull(), // 1-5\n    cleanliness: integer('cleanliness'),\n    location: integer('location'),\n    value: integer('value'),\n    communication: integer('communication'),\n    comment: text('comment'),\n    ownerReply: text('owner_reply'),\n    ownerRepliedAt: timestamp('owner_replied_at', { withTimezone: true }),\n    isVisible: boolean('is_visible').default(true),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n","import { pgTable, text, uuid, timestamp, boolean, jsonb } from 'drizzle-orm/pg-core';\nimport { users } from '@/db/schema/users';\nimport { bookings } from '@/db/schema/bookings';\nimport { notificationChannelEnum, ticketCategoryEnum, ticketPriorityEnum, ticketStatusEnum } from '@/db/schema/enums';\n\n// â”€â”€â”€ Messages (Owner â†” Customer) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const messages = pgTable('messages', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    conversationId: uuid('conversation_id').notNull(), // Groups messages\n    senderId: uuid('sender_id').references(() => users.id).notNull(),\n    receiverId: uuid('receiver_id').references(() => users.id).notNull(),\n    bookingId: uuid('booking_id').references(() => bookings.id), // Context\n    content: text('content').notNull(),\n    isRead: boolean('is_read').default(false),\n    readAt: timestamp('read_at', { withTimezone: true }),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Notifications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const notifications = pgTable('notifications', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    userId: uuid('user_id').references(() => users.id).notNull(),\n    type: text('type').notNull(), // booking_confirmed, payment_received\n    title: text('title').notNull(),\n    body: text('body'),\n    data: jsonb('data').default({}), // Deep-link metadata\n    channel: notificationChannelEnum('channel').default('in_app'),\n    isRead: boolean('is_read').default(false),\n    readAt: timestamp('read_at', { withTimezone: true }),\n    sentAt: timestamp('sent_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Support Tickets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const supportTickets = pgTable('support_tickets', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    ticketNumber: text('ticket_number').notNull().unique(), // SUP-20231001-001\n    userId: uuid('user_id').references(() => users.id).notNull(),\n    bookingId: uuid('booking_id').references(() => bookings.id),\n    category: ticketCategoryEnum('category').notNull(),\n    subject: text('subject').notNull(),\n    priority: ticketPriorityEnum('priority').default('medium'),\n    status: ticketStatusEnum('status').default('open'),\n    assignedTo: uuid('assigned_to').references(() => users.id), // Admin\n    resolvedAt: timestamp('resolved_at', { withTimezone: true }),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n\n// â”€â”€â”€ Support Messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const supportMessages = pgTable('support_messages', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    ticketId: uuid('ticket_id').references(() => supportTickets.id).notNull(),\n    senderId: uuid('sender_id').references(() => users.id).notNull(),\n    content: text('content').notNull(),\n    attachments: jsonb('attachments').default([]),\n    isInternal: boolean('is_internal').default(false), // Admin-only notes\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n","import { pgTable, text, uuid, timestamp, jsonb, inet } from 'drizzle-orm/pg-core';\nimport { users } from '@/db/schema/users';\n\n// â”€â”€â”€ Audit Logs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nexport const auditLogs = pgTable('audit_logs', {\n    id: uuid('id').defaultRandom().primaryKey(),\n    userId: uuid('user_id').references(() => users.id), // Nullable for system events\n    action: text('action').notNull(), // booking.created, payment.completed\n    entityType: text('entity_type').notNull(), // booking, stay, user\n    entityId: uuid('entity_id').notNull(),\n    oldValues: jsonb('old_values'),\n    newValues: jsonb('new_values'),\n    ipAddress: inet('ip_address'),\n    userAgent: text('user_agent'),\n    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),\n});\n","import { drizzle } from \"drizzle-orm/postgres-js\";\nimport postgres from \"postgres\"; // Using 'postgres' driver (postgres.js) as instructed in Drizzle docs usually\nimport * as schema from \"@/db/schema/index\";\nimport dotenv from \"dotenv\";\n\ndotenv.config();\n\nconst connectionString = process.env.DATABASE_URL;\n\nif (!connectionString) {\n    throw new Error(\"DATABASE_URL is not set\");\n}\n\n// Disable prefetch as it is not supported for \"Transaction\" pool mode\nexport const client = postgres(connectionString, {\n    prepare: false,\n    ssl: 'require'\n});\nexport const db = drizzle(client, { schema });\n","import { db } from '@/db/index';\nimport { stays } from '@/db/schema/index';\nimport { eq } from 'drizzle-orm';\n\nexport const StaysService = {\n    async getAll() {\n        return await db.select().from(stays);\n    },\n\n    async getById(id: string) {\n        const result = await db.select().from(stays).where(eq(stays.id, id));\n        return result[0] || null;\n    },\n\n    // Add create, update, delete methods...\n};\n","import type { Request, Response, NextFunction } from 'express';\n\nexport const catchAsync = (fn: (req: Request, res: Response, next: NextFunction) => Promise<any>) => {\n    return (req: Request, res: Response, next: NextFunction) => {\n        fn(req, res, next).catch(next);\n    };\n};\n","import type { Request, Response, NextFunction } from 'express';\nimport { StaysService } from '@/services/stay.service';\nimport { catchAsync } from '@/utils/catchAsync';\nimport { AppError } from '@/utils/AppError';\n\n/**\n * Stays Controller - Modular SaaS pattern\n */\nexport const StaysController = {\n    /**\n     * Get all stays\n     */\n    getAllStays: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const stays = await StaysService.getAll();\n        res.status(200).json({\n            status: 'success',\n            results: stays.length,\n            data: { stays },\n        });\n    }),\n\n    /**\n     * Get a single stay by ID\n     */\n    getStay: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { id } = req.params;\n\n        if (!id) {\n            return next(new AppError('Stay ID is required', 400));\n        }\n\n        const stay = await StaysService.getById(id as string);\n\n        if (!stay) {\n            return next(new AppError('No stay found with that ID', 404));\n        }\n\n        res.status(200).json({\n            status: 'success',\n            data: { stay },\n        });\n    }),\n};\n","import { Request, Response, NextFunction } from 'express';\nimport { AnyZodObject, ZodError } from 'zod';\nimport { catchAsync } from '@/utils/catchAsync';\nimport { AppError } from '@/utils/AppError';\n\n/**\n * Validation Middleware\n * Wraps a Zod schema and validates the request body, query, or params.\n */\nexport const validate = (schema: AnyZodObject) =>\n    catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        try {\n            await schema.parseAsync({\n                body: req.body,\n                query: req.query,\n                params: req.params,\n            });\n            return next();\n        } catch (error) {\n            if (error instanceof ZodError) {\n                const message = error.errors\n                    .map((err) => `${err.path.join('.')}: ${err.message}`)\n                    .join(', ');\n                return next(new AppError(message, 400));\n            }\n            return next(error);\n        }\n    });\n","import { z } from 'zod';\n\nexport const staySchema = {\n    createStay: z.object({\n        body: z.object({\n            name: z.string().min(3, 'Name must be at least 3 characters'),\n            type: z.enum(['hostel', 'flat', 'homestay']),\n            addressLine: z.string().min(5, 'Address is required'),\n            city: z.string().min(2, 'City is required'),\n            district: z.string().min(2, 'District is required'),\n            basePrice: z.number().positive('Price must be positive'),\n        }),\n    }),\n\n    getStay: z.object({\n        params: z.object({\n            id: z.string().uuid('Invalid Stay ID'),\n        }),\n    }),\n};\n","import { Router } from 'express';\nimport { StaysController } from '@/controllers/stays.controller';\nimport { validate } from '@/middlewares/validate.middleware';\nimport { staySchema } from '@/validations/stay.schema';\n\nconst router = Router();\n\n/**\n * Stays Routes - Production ready setup\n */\nrouter.get('/', StaysController.getAllStays);\nrouter.get('/:id', validate(staySchema.getStay), StaysController.getStay);\n\nexport default router;\n","import { db } from '@/db/index';\nimport { bookings, stays } from '@/db/schema/index';\nimport { eq, desc } from 'drizzle-orm';\n\nexport const BookingsService = {\n    async getAll() {\n        return await db\n            .select({\n                id: bookings.id,\n                guestName: bookings.guestName,\n                guestEmail: bookings.guestEmail,\n                guestPhone: bookings.guestPhone,\n                checkIn: bookings.checkIn,\n                checkOut: bookings.checkOut,\n                status: bookings.status,\n                totalAmount: bookings.totalAmount,\n                createdAt: bookings.createdAt,\n                stayName: stays.name, // Fetch property name\n            })\n            .from(bookings)\n            .leftJoin(stays, eq(bookings.stayId, stays.id))\n            .orderBy(desc(bookings.createdAt));\n    },\n\n    async getById(id: string) {\n        const result = await db\n            .select({\n                // Select all booking fields + stayName\n                id: bookings.id,\n                guestName: bookings.guestName,\n                guestEmail: bookings.guestEmail,\n                guestPhone: bookings.guestPhone,\n                checkIn: bookings.checkIn,\n                checkOut: bookings.checkOut,\n                status: bookings.status,\n                totalAmount: bookings.totalAmount,\n                createdAt: bookings.createdAt,\n                stayName: stays.name,\n                specialRequests: bookings.id, // Placeholder or add column if needed\n            })\n            .from(bookings)\n            .leftJoin(stays, eq(bookings.stayId, stays.id))\n            .where(eq(bookings.id, id));\n        return result[0] || null;\n    },\n\n    async create(data: typeof bookings.$inferInsert) {\n        const result = await db.insert(bookings).values(data).returning();\n        return result[0];\n    },\n\n    async updateStatus(id: string, status: string) {\n        // @ts-ignore - Drizzle enum type mismatch with string\n        const result = await db\n            .update(bookings)\n            .set({ status: status as any })\n            .where(eq(bookings.id, id))\n            .returning();\n        return result[0];\n    },\n};\n","import type { Request, Response, NextFunction } from 'express';\nimport { BookingsService } from '@/services/booking.service';\nimport { catchAsync } from '@/utils/catchAsync';\nimport { AppError } from '@/utils/AppError';\n\n/**\n * Bookings Controller - Modular SaaS pattern\n */\nexport const BookingsController = {\n    /**\n     * Get all bookings\n     */\n    getAllBookings: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const bookings = await BookingsService.getAll();\n        res.status(200).json({\n            status: 'success',\n            results: bookings.length,\n            data: { bookings },\n        });\n    }),\n\n    /**\n     * Get a single booking\n     */\n    getBooking: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { id } = req.params;\n\n        if (!id) {\n            return next(new AppError('Booking ID is required', 400));\n        }\n\n        const booking = await BookingsService.getById(id as string);\n\n        if (!booking) {\n            return next(new AppError('No booking found with that ID', 404));\n        }\n\n        res.status(200).json({\n            status: 'success',\n            data: { booking },\n        });\n    }),\n\n    /**\n     * Create a new booking\n     */\n    createBooking: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const newBooking = await BookingsService.create(req.body);\n\n        res.status(201).json({\n            status: 'success',\n            data: { booking: newBooking },\n        });\n    }),\n\n    /**\n     * Update booking status\n     */\n    updateBookingStatus: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { id } = req.params;\n        const { status } = req.body;\n\n        if (!status) {\n            return next(new AppError('Status is required', 400));\n        }\n\n        const updatedBooking = await BookingsService.updateStatus(id as string, status);\n\n        if (!updatedBooking) {\n            return next(new AppError('No booking found with that ID', 404));\n        }\n\n        res.status(200).json({\n            status: 'success',\n            data: { booking: updatedBooking },\n        });\n    }),\n};\n","import { z } from 'zod';\n\nexport const bookingSchema = {\n    createBooking: z.object({\n        body: z.object({\n            stayId: z.string().uuid('Invalid Stay ID'),\n            unitId: z.string().uuid('Invalid Unit ID'),\n            checkIn: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, 'Invalid check-in date format (YYYY-MM-DD)'),\n            checkOut: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, 'Invalid check-out date format (YYYY-MM-DD)'),\n            totalAmount: z.number().positive('Total amount must be positive'),\n        }),\n    }),\n\n    updateStatus: z.object({\n        params: z.object({\n            id: z.string().uuid('Invalid Booking ID'),\n        }),\n        body: z.object({\n            status: z.string().min(1, 'Status is required'),\n        }),\n    }),\n};\n","import { Router } from 'express';\nimport { BookingsController } from '@/controllers/bookings.controller';\nimport { validate } from '@/middlewares/validate.middleware';\nimport { bookingSchema } from '@/validations/booking.schema';\n\nconst router = Router();\n\n/**\n * Bookings Routes - Production ready setup\n */\nrouter.get('/', BookingsController.getAllBookings);\nrouter.get('/:id', validate(bookingSchema.updateStatus), BookingsController.getBooking);\nrouter.post('/', validate(bookingSchema.createBooking), BookingsController.createBooking);\nrouter.patch('/:id/status', validate(bookingSchema.updateStatus), BookingsController.updateBookingStatus);\n\nexport default router;\n","import { db } from '@/db/index';\nimport { users } from '@/db/schema/index';\nimport { eq, and } from 'drizzle-orm';\n\nexport const OwnersService = {\n    async getAll() {\n        return await db.select().from(users).where(eq(users.role, 'owner'));\n    },\n\n    async getById(id: string) {\n        const result = await db.select().from(users).where(and(eq(users.id, id), eq(users.role, 'owner')));\n        return result[0] || null;\n    },\n\n    async create(data: typeof users.$inferInsert) {\n        // Enforce role owner\n        const userData = { ...data, role: 'owner' as const };\n        const result = await db.insert(users).values(userData).returning();\n        return result[0];\n    },\n\n    async getByEmail(email: string) {\n        const result = await db.select().from(users).where(and(eq(users.email, email), eq(users.role, 'owner')));\n        return result[0] || null;\n    }\n};\n","import type { Request, Response, NextFunction } from 'express';\nimport { OwnersService } from '@/services/owner.service';\nimport { catchAsync } from '@/utils/catchAsync';\nimport { AppError } from '@/utils/AppError';\n\n/**\n * Owners Controller - Modular SaaS pattern\n */\nexport const OwnersController = {\n    /**\n     * Get all owners\n     */\n    getAllOwners: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const owners = await OwnersService.getAll();\n        res.status(200).json({\n            status: 'success',\n            results: owners.length,\n            data: { owners },\n        });\n    }),\n\n    /**\n     * Get a single owner\n     */\n    getOwner: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { id } = req.params;\n\n        if (!id) {\n            return next(new AppError('Owner ID is required', 400));\n        }\n\n        const owner = await OwnersService.getById(id as string);\n\n        if (!owner) {\n            return next(new AppError('No owner found with that ID', 404));\n        }\n\n        res.status(200).json({\n            status: 'success',\n            data: { owner },\n        });\n    }),\n\n    /**\n     * Create a new owner\n     */\n    createOwner: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { email } = req.body;\n        if (!email) {\n            return next(new AppError('Email is required', 400));\n        }\n\n        const existingOwner = await OwnersService.getByEmail(email);\n        if (existingOwner) {\n            return next(new AppError('Owner with this email already exists', 400));\n        }\n\n        const newOwner = await OwnersService.create(req.body);\n\n        res.status(201).json({\n            status: 'success',\n            data: { owner: newOwner },\n        });\n    }),\n};\n","import { Router } from 'express';\nimport { OwnersController } from '@/controllers/owners.controller';\n\nconst router = Router();\n\n/**\n * Owners Routes - Production ready setup\n */\nrouter.get('/', OwnersController.getAllOwners);\nrouter.get('/:id', OwnersController.getOwner);\nrouter.post('/', OwnersController.createOwner);\n\nexport default router;\n","import { db } from '@/db/index';\nimport { users } from '@/db/schema/index';\nimport { eq, and } from 'drizzle-orm';\n\nexport const CustomersService = {\n    async getAll() {\n        return await db.select().from(users).where(eq(users.role, 'customer'));\n    },\n\n    async getById(id: string) {\n        const result = await db.select().from(users).where(and(eq(users.id, id), eq(users.role, 'customer')));\n        return result[0] || null;\n    },\n\n    async create(data: typeof users.$inferInsert) {\n        // Enforce role customer\n        const userData = { ...data, role: 'customer' as const };\n        const result = await db.insert(users).values(userData).returning();\n        return result[0];\n    },\n\n    async getByEmail(email: string) {\n        const result = await db.select().from(users).where(and(eq(users.email, email), eq(users.role, 'customer')));\n        return result[0] || null;\n    }\n};\n","import type { Request, Response, NextFunction } from 'express';\nimport { CustomersService } from '@/services/customer.service';\nimport { catchAsync } from '@/utils/catchAsync';\nimport { AppError } from '@/utils/AppError';\n\n/**\n * Customers Controller - Modular SaaS pattern\n */\nexport const CustomersController = {\n    /**\n     * Get all customers\n     */\n    getAllCustomers: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const customers = await CustomersService.getAll();\n        res.status(200).json({\n            status: 'success',\n            results: customers.length,\n            data: { customers },\n        });\n    }),\n\n    /**\n     * Get a single customer\n     */\n    getCustomer: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { id } = req.params;\n\n        if (!id) {\n            return next(new AppError('Customer ID is required', 400));\n        }\n\n        const customer = await CustomersService.getById(id as string);\n\n        if (!customer) {\n            return next(new AppError('No customer found with that ID', 404));\n        }\n\n        res.status(200).json({\n            status: 'success',\n            data: { customer },\n        });\n    }),\n\n    /**\n     * Create a new customer\n     */\n    createCustomer: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { email } = req.body;\n        if (!email) {\n            return next(new AppError('Email is required', 400));\n        }\n\n        const existingCustomer = await CustomersService.getByEmail(email);\n        if (existingCustomer) {\n            return next(new AppError('Customer with this email already exists', 400));\n        }\n\n        const newCustomer = await CustomersService.create(req.body);\n\n        res.status(201).json({\n            status: 'success',\n            data: { customer: newCustomer },\n        });\n    }),\n};\n","import { Router } from 'express';\nimport { CustomersController } from '@/controllers/customers.controller';\n\nconst router = Router();\n\n/**\n * Customers Routes - Production ready setup\n */\nrouter.get('/', CustomersController.getAllCustomers);\nrouter.get('/:id', CustomersController.getCustomer);\nrouter.post('/', CustomersController.createCustomer);\n\nexport default router;\n","import type { Request, Response, NextFunction } from 'express';\n\n/**\n * Professional User Controller following SaaS standards.\n */\nexport const UserController = {\n    /**\n     * Get current user profile\n     */\n    getProfile: async (req: Request, res: Response, next: NextFunction) => {\n        try {\n            // In a real app, this would come from a service/DB\n            const mockUser = {\n                id: 'user_123',\n                email: 'user@example.com',\n                role: 'customer',\n                createdAt: new Date(),\n            };\n\n            return res.status(200).json({\n                status: 'success',\n                data: { user: mockUser },\n            });\n        } catch (error) {\n            next(error);\n        }\n    },\n\n    /**\n     * List all users (Admin only)\n     */\n    listUsers: async (req: Request, res: Response, next: NextFunction) => {\n        try {\n            return res.status(200).json({\n                status: 'success',\n                data: { users: [] },\n            });\n        } catch (error) {\n            next(error);\n        }\n    },\n};\n","import { Router } from 'express';\nimport { UserController } from '@/controllers/user.controller';\n\nconst router = Router();\n\n/**\n * @route GET /api/users/profile\n * @desc Get user profile\n * @access Private\n */\nrouter.get('/profile', UserController.getProfile);\n\n/**\n * @route GET /api/users\n * @desc List all users\n * @access Private/Admin\n */\nrouter.get('/', UserController.listUsers);\n\nexport default router;\n","import { db } from '@/db/index';\nimport { stayMedia } from '@/db/schema/index';\nimport { eq, and, isNull } from 'drizzle-orm';\n\n/**\n * Media Service - Principal Engineer Implementation\n * Handles business logic for stay and unit media assets.\n */\nexport const MediaService = {\n    /**\n     * Add a new media asset\n     */\n    async addMedia(data: typeof stayMedia.$inferInsert) {\n        const result = await db.insert(stayMedia).values(data).returning();\n        return result[0];\n    },\n\n    /**\n     * Get all media for a specific stay (Property level only if unitId is null)\n     */\n    async getMediaByStay(stayId: string, propertyOnly = false) {\n        const query = propertyOnly\n            ? and(eq(stayMedia.stayId, stayId), isNull(stayMedia.unitId))\n            : eq(stayMedia.stayId, stayId);\n\n        return await db.select().from(stayMedia).where(query).orderBy(stayMedia.sortOrder);\n    },\n\n    /**\n     * Get all media for a specific stay unit (Room level)\n     */\n    async getMediaByUnit(unitId: string) {\n        return await db\n            .select()\n            .from(stayMedia)\n            .where(eq(stayMedia.unitId, unitId))\n            .orderBy(stayMedia.sortOrder);\n    },\n\n    /**\n     * Delete a media asset\n     */\n    async deleteMedia(id: string) {\n        const result = await db.delete(stayMedia).where(eq(stayMedia.id, id)).returning();\n        return result[0];\n    },\n\n    /**\n     * Set an image as the cover for a stay or unit\n     * Ensures only one cover exists for the given context\n     */\n    async setCover(id: string, stayId: string, unitId?: string) {\n        return await db.transaction(async (tx) => {\n            // 1. Remove cover flag from all other media in this context\n            const contextQuery = unitId\n                ? and(eq(stayMedia.stayId, stayId), eq(stayMedia.unitId, unitId))\n                : and(eq(stayMedia.stayId, stayId), isNull(stayMedia.unitId));\n\n            await tx.update(stayMedia).set({ isCover: false }).where(contextQuery);\n\n            // 2. Set new cover\n            const result = await tx\n                .update(stayMedia)\n                .set({ isCover: true })\n                .where(eq(stayMedia.id, id))\n                .returning();\n\n            return result[0];\n        });\n    },\n\n    /**\n     * Update media metadata (caption, sort order, etc.)\n     */\n    async updateMedia(id: string, data: Partial<typeof stayMedia.$inferInsert>) {\n        const result = await db\n            .update(stayMedia)\n            .set({ ...data })\n            .where(eq(stayMedia.id, id))\n            .returning();\n        return result[0];\n    }\n};\n","import type { Request, Response, NextFunction } from 'express';\nimport { MediaService } from '@/services/media.service';\nimport { catchAsync } from '@/utils/catchAsync';\nimport { AppError } from '@/utils/AppError';\n\n/**\n * Media Controller - Professional SaaS Pattern\n */\nexport const MediaController = {\n    /**\n     * Save a new media record (URL based)\n     */\n    uploadMedia: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { stayId, unitId, url, type, caption, isCover } = req.body;\n\n        if (!stayId || !url) {\n            return next(new AppError('Stay ID and URL are required', 400));\n        }\n\n        const media = await MediaService.addMedia({\n            stayId,\n            unitId: unitId || null,\n            url,\n            type: type || 'image',\n            caption,\n            isCover: isCover || false,\n        });\n\n        res.status(201).json({\n            status: 'success',\n            data: { media },\n        });\n    }),\n\n    /**\n     * Get media for a stay\n     */\n    getStayMedia: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { stayId } = req.params;\n        const { propertyOnly } = req.query;\n\n        if (!stayId) {\n            return next(new AppError('Stay ID is required', 400));\n        }\n\n        const media = await MediaService.getMediaByStay(\n            stayId as string,\n            propertyOnly === 'true'\n        );\n\n        res.status(200).json({\n            status: 'success',\n            results: media.length,\n            data: { media },\n        });\n    }),\n\n    /**\n     * Get media for a specific unit (room)\n     */\n    getUnitMedia: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { unitId } = req.params;\n\n        if (!unitId) {\n            return next(new AppError('Unit ID is required', 400));\n        }\n\n        const media = await MediaService.getMediaByUnit(unitId as string);\n\n        res.status(200).json({\n            status: 'success',\n            results: media.length,\n            data: { media },\n        });\n    }),\n\n    /**\n     * Set cover image\n     */\n    setCover: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { id } = req.params;\n        const { stayId, unitId } = req.body;\n\n        if (!stayId) {\n            return next(new AppError('Stay ID is required in body', 400));\n        }\n\n        const media = await MediaService.setCover(id as string, stayId as string, unitId as string);\n\n        res.status(200).json({\n            status: 'success',\n            data: { media },\n        });\n    }),\n\n    /**\n     * Delete media\n     */\n    removeMedia: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { id } = req.params;\n\n        const media = await MediaService.deleteMedia(id as string);\n\n        if (!media) {\n            return next(new AppError('No media found with that ID', 404));\n        }\n\n        res.status(204).json({\n            status: 'success',\n            data: null,\n        });\n    }),\n};\n","import { Router } from 'express';\nimport { MediaController } from '@/controllers/media.controller';\n\nconst router = Router();\n\n/**\n * Media Management Routes\n */\n\n// Global media operations\nrouter.post('/', MediaController.uploadMedia);\nrouter.delete('/:id', MediaController.removeMedia);\nrouter.patch('/:id/cover', MediaController.setCover);\n\n// Stay specific media\nrouter.get('/stays/:stayId', MediaController.getStayMedia);\n\n// Unit specific media\nrouter.get('/units/:unitId', MediaController.getUnitMedia);\n\nexport default router;\n","import { db } from '@/db/index';\nimport { users } from '@/db/schema/index';\nimport { eq } from 'drizzle-orm';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\nimport { env } from '@/config/env';\n\n/**\n * Authentication Service\n * Handles user identity, token generation, and password security.\n */\nexport const AuthService = {\n    /**\n     * Generate JWT for a user\n     */\n    generateToken(id: string) {\n        const secret = process.env.JWT_SECRET || 'fallback_secret';\n        return jwt.sign({ id }, secret, {\n            expiresIn: (process.env.JWT_EXPIRES_IN || '30d') as any,\n        });\n    },\n\n    /**\n     * Compare passwords\n     */\n    async comparePasswords(entered: string, stored: string) {\n        return await bcrypt.compare(entered, stored);\n    },\n\n    /**\n     * Login user by verifying credentials\n     */\n    async login(email: string, pass: string) {\n        const user = await db.query.users.findFirst({\n            where: eq(users.email, email),\n        });\n\n        if (!user || !user.password) return null;\n\n        const isMatch = await this.comparePasswords(pass, user.password);\n        if (!isMatch) return null;\n\n        const { password, ...userWithoutPassword } = user;\n        return userWithoutPassword;\n    },\n\n    /**\n     * Signup new user\n     */\n    async signup(data: typeof users.$inferInsert) {\n        const hashedPassword = await bcrypt.hash(data.password!, 12);\n\n        const result = await db.insert(users).values({\n            ...data,\n            password: hashedPassword,\n        }).returning();\n\n        const user = result[0];\n        const { password, ...userWithoutPassword } = user;\n        return userWithoutPassword;\n    }\n};\n","import type { Request, Response, NextFunction } from 'express';\nimport { AuthService } from '@/services/auth.service';\nimport { catchAsync } from '@/utils/catchAsync';\nimport { AppError } from '@/utils/AppError';\n\n/**\n * Auth Controller - Principal Engineer Implementation\n */\nexport const AuthController = {\n    /**\n     * Set JWT cookie in response\n     */\n    sendTokenCookie(user: any, statusCode: number, res: Response) {\n        const token = AuthService.generateToken(user.id);\n\n        const cookieOptions = {\n            expires: new Date(\n                Date.now() + 30 * 24 * 60 * 60 * 1000 // 30 days\n            ),\n            httpOnly: true,\n            secure: process.env.NODE_ENV === 'production',\n            sameSite: (process.env.NODE_ENV === 'production' ? 'none' : 'lax') as 'none' | 'lax',\n        };\n\n        res.cookie('jwt', token, cookieOptions);\n\n        res.status(statusCode).json({\n            status: 'success',\n            token,\n            data: { user },\n        });\n    },\n\n    /**\n     * User Signup\n     */\n    signup: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { email, password, fullName, role } = req.body;\n\n        if (!email || !password || !fullName) {\n            return next(new AppError('Please provide email, password and full name', 400));\n        }\n\n        const newUser = await AuthService.signup({\n            email,\n            password,\n            fullName,\n            role: role || 'customer',\n        });\n\n        AuthController.sendTokenCookie(newUser, 201, res);\n    }),\n\n    /**\n     * User Login\n     */\n    login: catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n        const { email, password } = req.body;\n\n        if (!email || !password) {\n            return next(new AppError('Please provide email and password', 400));\n        }\n\n        const user = await AuthService.login(email, password);\n\n        if (!user) {\n            return next(new AppError('Incorrect email or password', 401));\n        }\n\n        AuthController.sendTokenCookie(user, 200, res);\n    }),\n\n    /**\n     * User Logout\n     */\n    logout: (req: Request, res: Response) => {\n        res.cookie('jwt', 'loggedout', {\n            expires: new Date(Date.now() + 10 * 1000),\n            httpOnly: true,\n        });\n        res.status(200).json({ status: 'success' });\n    },\n\n    /**\n     * Get Current User (Me)\n     */\n    getMe: (req: Request, res: Response) => {\n        // @ts-ignore\n        res.status(200).json({\n            status: 'success',\n            data: { user: req.user },\n        });\n    },\n};\n","import type { Request, Response, NextFunction } from 'express';\nimport jwt from 'jsonwebtoken';\nimport { db } from '@/db/index';\nimport { users } from '@/db/schema/index';\nimport { eq } from 'drizzle-orm';\nimport { AppError } from '@/utils/AppError';\nimport { catchAsync } from '@/utils/catchAsync';\n\n// Extend Express Request type to include user\ndeclare global {\n    namespace Express {\n        interface Request {\n            user?: any;\n        }\n    }\n}\n\n/**\n * Authentication Middleware\n */\nexport const protect = catchAsync(async (req: Request, res: Response, next: NextFunction) => {\n    // 1. Getting token and check if it's there\n    let token;\n    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\n        token = req.headers.authorization.split(' ')[1];\n    } else if (req.cookies.jwt) {\n        token = req.cookies.jwt;\n    }\n\n    if (!token) {\n        return next(new AppError('You are not logged in! Please log in to get access.', 401));\n    }\n\n    // 2. Verification token\n    // @ts-ignore\n    const decoded = jwt.verify(token, process.env.JWT_SECRET || 'fallback_secret') as { id: string };\n\n    // 3. Check if user still exists\n    const currentUser = await db.query.users.findFirst({\n        where: eq(users.id, decoded.id),\n    });\n\n    if (!currentUser) {\n        return next(new AppError('The user belonging to this token no longer exists.', 401));\n    }\n\n    // 4. Grant access to protected route\n    const { password, ...userWithoutPassword } = currentUser;\n    req.user = userWithoutPassword;\n    next();\n});\n\n/**\n * Authorization Middleware\n */\nexport const restrictTo = (...roles: string[]) => {\n    return (req: Request, res: Response, next: NextFunction) => {\n        if (!roles.includes(req.user.role)) {\n            return next(new AppError('You do not have permission to perform this action', 403));\n        }\n        next();\n    };\n};\n","import { z } from 'zod';\n\nexport const authSchema = {\n    signup: z.object({\n        body: z.object({\n            fullName: z.string().min(2, 'Full name must be at least 2 characters'),\n            email: z.string().email('Invalid email address'),\n            password: z.string().min(8, 'Password must be at least 8 characters'),\n            role: z.enum(['customer', 'owner', 'admin']).optional(),\n        }),\n    }),\n\n    login: z.object({\n        body: z.object({\n            email: z.string().email('Invalid email address'),\n            password: z.string().min(1, 'Password is required'),\n        }),\n    }),\n};\n","import { AuthController } from '@/controllers/auth.controller';\nimport { protect } from '@/middlewares/auth.middleware';\nimport { validate } from '@/middlewares/validate.middleware';\nimport { authSchema } from '@/validations/auth.schema';\n\nconst router = Router();\n\nrouter.post('/signup', validate(authSchema.signup), AuthController.signup);\nrouter.post('/login', validate(authSchema.login), AuthController.login);\nrouter.get('/logout', AuthController.logout);\n\n/**\n * Protected routes\n */\nrouter.get('/me', protect, AuthController.getMe);\n\nexport default router;\n","import { Router } from 'express';\nimport staysRouter from '@/routes/stays.routes';\nimport bookingsRouter from '@/routes/bookings.routes';\nimport ownersRouter from '@/routes/owners.routes';\nimport customersRouter from '@/routes/customers.routes';\nimport userRoutes from '@/routes/user.routes';\nimport mediaRouter from '@/routes/media.routes';\nimport authRouter from '@/routes/auth.routes';\n\nconst router = Router();\n\nrouter.use('/auth', authRouter);\nrouter.use('/stays', staysRouter);\nrouter.use('/bookings', bookingsRouter);\nrouter.use('/owners', ownersRouter);\nrouter.use('/customers', customersRouter);\nrouter.use('/users', userRoutes);\nrouter.use('/media', mediaRouter);\n\nexport default router;\n","import app from '@/app';\nimport { env } from '@/config/env';\nimport { db } from '@/db/index';\n\nconst bootstrap = async () => {\n    try {\n        const port = env.PORT || 8000;\n\n        app.listen(port, () => {\n            console.log(`ðŸš€ Production-ready server running at http://localhost:${port}`);\n            console.log(`ðŸ“¡ Environment: ${env.NODE_ENV}`);\n        });\n    } catch (error) {\n        console.error('âŒ Failed to start server:', error);\n        process.exit(1);\n    }\n};\n\nbootstrap();\n"]}